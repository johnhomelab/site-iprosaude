
services:
  payload:
    build: .  # Isso diz ao Docker para usar o Dockerfile que o Jules criou
    image: iprosaude-local:latest
    restart: always
    ports:
      - '3010:3000'
    volumes:
      - ./media:/app/media
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    environment:
      - DATABASE_URI=postgres://john:123456@iprosaude-pg:5432/iprosaude_site
      - REDIS_URL=redis://redis:6379
      - PAYLOAD_SECRET=6d824a8fcb75e45621bded4328a9cb02
      - NODE_ENV=production
    command: >
      sh -c "echo '--- ENV VARS ---';
      env | sed -e 's/DATABASE_URI=.*/DATABASE_URI=******/' -e 's/PAYLOAD_SECRET=.*/PAYLOAD_SECRET=******/';
      echo '--- END ENV VARS ---';
      node check-env.js && node server.js || tail -f /dev/null"
    networks:
      - app

networks:
  app:
    external: true
    name: app  # Aqui você coloca o nome real da rede que você criou no Portainer
